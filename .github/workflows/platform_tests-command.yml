name: Platform Tests
on:
  schedule:
    - cron: '59 07 * * *'  #  UTC 7:59(23:59 PST Winter Time) everyday
  workflow_dispatch:

jobs:
  tabular:
    needs: setup
    runs-on: ${{ matrix.os }}
    timeout-minutes: 60
    defaults:
      run:
        shell: bash
    strategy:
      matrix:
        os: [macos-latest]
    steps:
      - name: Checkout repository for PR
        if: (github.event_name == 'workflow_dispatch')
        uses: actions/checkout@v2
        with:
          ref: ${{ github.event.inputs.pr-sha }}
      - name: Checkout repository for nightly test
        if: (github.event_name == 'schedule')
        uses: actions/checkout@v2
      - name: Setup Miniconda
        uses: conda-incubator/setup-miniconda@v2.0.0
        with:
          activate-environment: autogluon_py3
          environment-file: .github/workflows_env/unittest_env.yml
          auto-update-conda: true
          python-version: 3.9
      - name: unit-test
        shell: bash -l {0}
        run: |
          python3 -m pip install --upgrade "mxnet<2.0.0"
          python3 -m pip install --upgrade -e common/[tests]
          python3 -m pip install --upgrade -e core/[all]
          python3 -m pip install --upgrade -e features/
          python3 -m pip install --upgrade -e tabular/[all,tests]
          env
          cd tabular/
          python3 -m pytest --junitxml=results.xml --runslow -m "not gpu" tests
